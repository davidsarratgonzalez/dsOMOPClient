<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="dsOMOPClient">
<title>2. Table retrieval • dsOMOPClient</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="2. Table retrieval">
<meta property="og:description" content="dsOMOPClient">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">dsOMOPClient</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/01_object.html">1. Interface object</a>
    <a class="dropdown-item" href="../articles/02_tables.html">2. Table retrieval</a>
    <a class="dropdown-item" href="../articles/03_integration.html">3. Workflow integration</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>2. Table retrieval</h1>
            
      
      
      <div class="d-none name"><code>02_tables.Rmd</code></div>
    </div>

    
    
<p>We have already seen how to create an interface object for the OMOP
CDM database. Now, let’s see how to use it to retrieve tables from the
database. For this purpose, we will use the <code>get</code> method of
the interface object. This method has several arguments that allow
filtering the data that is retrieved and customizing the output.</p>
<div class="section level2">
<h2 id="features-of-the-get-method">2.1 Features of the <code>get</code> method<a class="anchor" aria-label="anchor" href="#features-of-the-get-method"></a>
</h2>
<div class="section level3">
<h3 id="table-reshaping">2.1.1 Table reshaping<a class="anchor" aria-label="anchor" href="#table-reshaping"></a>
</h3>
<p>The <code>get</code> method is an intelligent method that returns the
table after subjecting it to a series of operations. If it detects that
this table can present various records linked to the same entity (for
example, to a <code>Person</code>), it will transform the table into a
wide format using the ds.reShape function, ready to be merged with other
tables. For instance, when we take the <code>Person</code> table, it
will return a table without altering its original format:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"person"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.summary.html" class="external-link">ds.summary</a></span><span class="op">(</span><span class="st">"person"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $brge</span></span>
<span><span class="co">## $brge$class</span></span>
<span><span class="co">## [1] "omop.cdm.table" "data.frame"    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`number of rows`</span></span>
<span><span class="co">## [1] 100</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`number of columns`</span></span>
<span><span class="co">## [1] 11</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`variables held`</span></span>
<span><span class="co">##  [1] "person_id"            "gender_concept_id"    "year_of_birth"       </span></span>
<span><span class="co">##  [4] "month_of_birth"       "day_of_birth"         "birth_datetime"      </span></span>
<span><span class="co">##  [7] "race_concept_id"      "ethnicity_concept_id" "location_id"         </span></span>
<span><span class="co">## [10] "provider_id"          "care_site_id"</span></span></code></pre>
<p>Whereas if we take the <code>Measurement</code> table, which has
records potentially linkable to the <code>Person</code> table, it will
return a table in wide format, preserving the column
<code>person_id</code> so that it can be merged with the
<code>Person</code> table:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span>table <span class="op">=</span> <span class="st">"measurement"</span>, conceptFilter <span class="op">=</span> <span class="fl">3000099</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.summary.html" class="external-link">ds.summary</a></span><span class="op">(</span><span class="st">"measurement"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $brge</span></span>
<span><span class="co">## $brge$class</span></span>
<span><span class="co">## [1] "omop.cdm.table" "data.frame"    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`number of rows`</span></span>
<span><span class="co">## [1] 11</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`number of columns`</span></span>
<span><span class="co">## [1] 15</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`variables held`</span></span>
<span><span class="co">##  [1] "person_id"                                                                  </span></span>
<span><span class="co">##  [2] "nuclear_ab_units_volume_in_serum_by_immunoassay.measurement_id"             </span></span>
<span><span class="co">##  [3] "nuclear_ab_units_volume_in_serum_by_immunoassay.measurement_date"           </span></span>
<span><span class="co">##  [4] "nuclear_ab_units_volume_in_serum_by_immunoassay.measurement_datetime"       </span></span>
<span><span class="co">##  [5] "nuclear_ab_units_volume_in_serum_by_immunoassay.measurement_time"           </span></span>
<span><span class="co">##  [6] "nuclear_ab_units_volume_in_serum_by_immunoassay.measurement_type_concept_id"</span></span>
<span><span class="co">##  [7] "nuclear_ab_units_volume_in_serum_by_immunoassay.operator_concept_id"        </span></span>
<span><span class="co">##  [8] "nuclear_ab_units_volume_in_serum_by_immunoassay.value_as_number"            </span></span>
<span><span class="co">##  [9] "nuclear_ab_units_volume_in_serum_by_immunoassay.value_as_concept_id"        </span></span>
<span><span class="co">## [10] "nuclear_ab_units_volume_in_serum_by_immunoassay.unit_concept_id"            </span></span>
<span><span class="co">## [11] "nuclear_ab_units_volume_in_serum_by_immunoassay.range_low"                  </span></span>
<span><span class="co">## [12] "nuclear_ab_units_volume_in_serum_by_immunoassay.range_high"                 </span></span>
<span><span class="co">## [13] "nuclear_ab_units_volume_in_serum_by_immunoassay.provider_id"                </span></span>
<span><span class="co">## [14] "nuclear_ab_units_volume_in_serum_by_immunoassay.visit_occurrence_id"        </span></span>
<span><span class="co">## [15] "nuclear_ab_units_volume_in_serum_by_immunoassay.visit_detail_id"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="concept-translation">2.1.2 Concept translation<a class="anchor" aria-label="anchor" href="#concept-translation"></a>
</h3>
<p>Another feature you may have noticed in the previous example is that
the <code>get</code> method automatically translates the concepts of the
table that we are retrieving. For instance, in the case of the
<code>Measurement</code> table, the concept <code>3000099</code> was
translated to
<code>Nuclear Ab [Units/volume] in Serum by Immunoassay</code>.</p>
<p>The same happens with the values of the rows in the tables. For
example, in the <code>Person</code> table, in the
<code>gender_concept_id</code> column, the value <code>8532</code> was
translated to <code>FEMALE</code> and the value <code>8507</code> was
translated to <code>MALE</code> automatically.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.summary.html" class="external-link">ds.summary</a></span><span class="op">(</span><span class="st">"person$gender_concept_id"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $brge</span></span>
<span><span class="co">## $brge$class</span></span>
<span><span class="co">## [1] "factor"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$length</span></span>
<span><span class="co">## [1] 100</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$categories</span></span>
<span><span class="co">## [1] "female" "male"  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`count of 'female'`</span></span>
<span><span class="co">## [1] 43</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`count of 'male'`</span></span>
<span><span class="co">## [1] 57</span></span></code></pre>
<p>This will happen automatically with all concepts in the database as
long as they are recognized and properly named in the
<code>Concept</code> table of the database. Otherwise, the concept will
remain as <code>concept_id_</code> + the numeric value of the concept.
For example, if the concept <code>FEMALE</code> was not properly named
in the <code>Concept</code> table, it would remain as
<code>concept_id_8532</code>.</p>
</div>
<div class="section level3">
<h3 id="longitudinal-data-sequencing">2.1.3 Longitudinal data sequencing<a class="anchor" aria-label="anchor" href="#longitudinal-data-sequencing"></a>
</h3>
<p>When dealing with longitudinal data, where multiple records of the
same type exist for the same entity over time (for example, several
<code>Breath rate spontaneous</code> measurements for the same
<code>person</code>), the <code>get</code> method will not only
transform the table into a wide format but will also add numerically
suffixed columns for each occurrence. This allows for a comprehensive
view of the data over time, preserving the temporal sequence of events
or measurements for each entity.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span>table <span class="op">=</span> <span class="st">"measurement"</span>, conceptFilter <span class="op">=</span> <span class="fl">1175625</span>, columnFilter <span class="op">=</span> <span class="st">"value_as_number"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.summary.html" class="external-link">ds.summary</a></span><span class="op">(</span><span class="st">"measurement"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $brge</span></span>
<span><span class="co">## $brge$class</span></span>
<span><span class="co">## [1] "omop.cdm.table" "data.frame"    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`number of rows`</span></span>
<span><span class="co">## [1] 55</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`number of columns`</span></span>
<span><span class="co">## [1] 139</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`variables held`</span></span>
<span><span class="co">##  [1] "person_id"                                </span></span>
<span><span class="co">##  [2] "breath_rate_spontaneous.value_as_number"  </span></span>
<span><span class="co">##  [3] "breath_rate_spontaneous.2.value_as_number"</span></span>
<span><span class="co">##  [4] "breath_rate_spontaneous.3.value_as_number"</span></span>
<span><span class="co">##  [5] "breath_rate_spontaneous.4.value_as_number"</span></span>
<span><span class="co">##  [6] "breath_rate_spontaneous.5.value_as_number"</span></span>
<span><span class="co">##  [7] "breath_rate_spontaneous.6.value_as_number"</span></span>
<span><span class="co">##  [8] "breath_rate_spontaneous.7.value_as_number"</span></span>
<span><span class="co">##  [9] "breath_rate_spontaneous.8.value_as_number"</span></span>
<span><span class="co">## [10] "breath_rate_spontaneous.9.value_as_number"</span></span>
<span><span class="co">##  [ reached getOption("max.print") -- omitted 129 entries ]</span></span></code></pre>
<p>The method by which these additional data columns are aggregated is
left to the discretion of the researcher. This flexibility ensures that
the data can be structured in a way that best suits the analysis being
performed.</p>
<p>Furthermore, <code>dsOMOP</code> provides support for server-side
functions that identify when a table obtained directly from the OMOP CDM
database remains unaltered. When integrated into the DataSHIELD
workflow, the table will have the class <code>omop.cdm.table</code> in
addition to <code>data.frame</code>, but if it is modified in terms of
its original composition, it will lose the <code>omop.cdm.table</code>
class.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.class.html" class="external-link">ds.class</a></span><span class="op">(</span><span class="st">"measurement"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $brge</span></span>
<span><span class="co">## [1] "omop.cdm.table" "data.frame"</span></span></code></pre>
<p>This class check serves as a mechanism to ensure that certain data
have not been modified between their retrieval from the database and
their interaction with the user. This allows for the use of more
permissive data manipulation methods from server-side packages, under
the assumption that the data are not being maliciously altered by the
user (since there is no function from the client-side that could modify
the object’s classes directly), thereby enabling developers to build
packages with specific functionalities for dealing with longitudinal
data.</p>
</div>
</div>
<div class="section level2">
<h2 id="using-the-get-method">2.2 Using the <code>get</code> method<a class="anchor" aria-label="anchor" href="#using-the-get-method"></a>
</h2>
<p>The <code>get</code> method has several arguments that allow for the
customization of the data that is retrieved. These arguments are:</p>
<ul>
<li>
<code>table</code>: the name of the table to be retrieved.</li>
<li>
<code>symbol</code>: the name of the symbol that will be used to
store the table in the server’s R environment. If not specified, the
table will be stored in a symbol with the same name as the table.</li>
<li>
<code>conceptFilter</code>: a numeric vector with the concept IDs to
be retrieved. It can also be a single numeric value.</li>
<li>
<code>columnFilter</code>: a character vector with the names of the
columns to be retrieved. It can also be a single character value.</li>
<li>
<code>personFilter</code>: the name of another symbol in the
server’s R environment which contains the person IDs to be retrieved by
the current <code>get</code> operation. If not specified, all existing
person IDs will be retrieved.</li>
<li>
<code>mergeColumn</code>: the name of the column that will be used
to merge the table with another table. If not specified, the
<code>person_id</code> column will be used as the default merge
column.</li>
<li>
<code>dropNA</code>: a logical value indicating whether empty
columns should be automatically filtered out from the table. The default
value is <code>TRUE</code>.</li>
</ul>
<p>Note that only the <code>table</code> parameter is mandatory for
retrieving a table. However, it is highly recommended to utilize the
available data filtering parameters, as they can significantly enhance
the performance of operations and ensure that only the relevant data for
your study is selected.</p>
<div class="section level3">
<h3 id="applying-basic-filters">2.2.1 Applying basic filters<a class="anchor" aria-label="anchor" href="#applying-basic-filters"></a>
</h3>
<p>This part is quite straightforward. We use the <code>tables()</code>
command to know which tables we can take, <code>columns()</code> to know
what columns we have available, and <code>concepts()</code> to
understand what concepts are present as entities in the table and select
those we wish to work with.</p>
<p>Once we have identified the specific data we are interested in
analyzing, we can apply the <code>columnFilter</code> and
<code>conceptFilter</code> parameters to retrieve the desired
<code>table</code>.</p>
<p>Let’s proceed with an example.</p>
<p>We check the available tables:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span><span class="op">$</span><span class="fu">tables</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $brge</span></span>
<span><span class="co">##  [1] "attribute_definition" "care_site"            "cdm_source"          </span></span>
<span><span class="co">##  [4] "cohort"               "cohort_attribute"     "cohort_definition"   </span></span>
<span><span class="co">##  [7] "concept_relationship" "condition_era"        "condition_occurrence"</span></span>
<span><span class="co">## [10] "cost"                 "death"                "device_exposure"     </span></span>
<span><span class="co">## [13] "dose_era"             "drug_era"             "drug_exposure"       </span></span>
<span><span class="co">## [16] "fact_relationship"    "location"             "measurement"         </span></span>
<span><span class="co">## [19] "metadata"             "note"                 "note_nlp"            </span></span>
<span><span class="co">## [22] "observation"          "observation_period"   "payer_plan_period"   </span></span>
<span><span class="co">## [25] "person"               "procedure_occurrence" "provider"            </span></span>
<span><span class="co">## [28] "specimen"             "visit_detail"         "visit_occurrence"    </span></span>
<span><span class="co">## [31] "vocabulary"           "concept"</span></span></code></pre>
<p>Let’s say we want to retrieve some measurements from the
<code>Measurement</code> table. We can use the <code>concepts()</code>
command to see what concepts are available in this table:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span><span class="op">$</span><span class="fu">concepts</span><span class="op">(</span><span class="st">"measurement"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $brge</span></span>
<span><span class="co">##   concept_id                                       concept_name</span></span>
<span><span class="co">## 1          0                                No matching concept</span></span>
<span><span class="co">## 2    1175625                            Breath rate spontaneous</span></span>
<span><span class="co">## 3    3000067 Parathyrin.intact [Mass/volume] in Serum or Plasma</span></span>
<span><span class="co">## 4    3000068                      oxyCODONE [Presence] in Urine</span></span>
<span><span class="co">## 5    3000099  Nuclear Ab [Units/volume] in Serum by Immunoassay</span></span>
<span><span class="co">##  [ reached 'max' / getOption("max.print") -- omitted 445 rows ]</span></span></code></pre>
<p>We have decided to retrieve the information related to the concept
<code>3000099</code> (which corresponds to
<code>Nuclear Ab [Units/volume] in Serum by Immunoassay</code>).</p>
<p>But we don’t want to retrieve all the columns from the table, so we
can use the <code>columns()</code> command to see what columns are
available in the <code>Measurement</code> table:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span><span class="op">$</span><span class="fu">columns</span><span class="op">(</span><span class="st">"measurement"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $brge</span></span>
<span><span class="co">##  [1] "measurement_id"                "person_id"                    </span></span>
<span><span class="co">##  [3] "measurement_concept_id"        "measurement_date"             </span></span>
<span><span class="co">##  [5] "measurement_datetime"          "measurement_time"             </span></span>
<span><span class="co">##  [7] "measurement_type_concept_id"   "operator_concept_id"          </span></span>
<span><span class="co">##  [9] "value_as_number"               "value_as_concept_id"          </span></span>
<span><span class="co">## [11] "unit_concept_id"               "range_low"                    </span></span>
<span><span class="co">## [13] "range_high"                    "provider_id"                  </span></span>
<span><span class="co">## [15] "visit_occurrence_id"           "visit_detail_id"              </span></span>
<span><span class="co">## [17] "measurement_source_value"      "measurement_source_concept_id"</span></span>
<span><span class="co">## [19] "unit_source_value"             "value_source_value"</span></span></code></pre>
<p>We are only interested in the <code>measurement_date</code> and
<code>value_as_number</code> from the <code>Measurement</code> table
related to the concept <code>3000099</code>. We can use the
<code>get</code> method to retrieve this information:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span>table <span class="op">=</span> <span class="st">"measurement"</span>, <span class="co"># the table we want to retrieve</span></span>
<span>      symbol <span class="op">=</span> <span class="st">"my_table"</span>, <span class="co"># the name of the symbol that will store the table</span></span>
<span>      conceptFilter <span class="op">=</span> <span class="fl">3000099</span>, <span class="co"># the concept we are interested in</span></span>
<span>      columnFilter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"measurement_date"</span>, <span class="st">"value_as_concept_id"</span><span class="op">)</span>, <span class="co"># the only columns we want to retrieve</span></span>
<span>      dropNA <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># whether we want to drop empty columns or not</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.summary.html" class="external-link">ds.summary</a></span><span class="op">(</span><span class="st">"my_table"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $brge</span></span>
<span><span class="co">## $brge$class</span></span>
<span><span class="co">## [1] "omop.cdm.table" "data.frame"    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`number of rows`</span></span>
<span><span class="co">## [1] 11</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`number of columns`</span></span>
<span><span class="co">## [1] 3</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`variables held`</span></span>
<span><span class="co">## [1] "person_id"                                                          </span></span>
<span><span class="co">## [2] "nuclear_ab_units_volume_in_serum_by_immunoassay.measurement_date"   </span></span>
<span><span class="co">## [3] "nuclear_ab_units_volume_in_serum_by_immunoassay.value_as_concept_id"</span></span></code></pre>
<p>Now this information is ready to be used within the DataSHIELD
environment for any analysis or data manipulation operations that we
want to perform. In the next article, we will see how to use the
built-in functions of DataSHIELD’s <code>dsBaseClient</code> package to
combine it with other tables.</p>
</div>
<div class="section level3">
<h3 id="selecting-a-merge-column">2.2.2 Selecting a merge column<a class="anchor" aria-label="anchor" href="#selecting-a-merge-column"></a>
</h3>
<p>When retrieving a table, it is possible to specify a column that will
be used to merge the table with another table. This is done using the
<code>mergeColumn</code> argument. For example, when retrieving the
<code>Visit_detail</code> table, we can specify that the column
<code>visit_occurrence_id</code> will be used to merge this table with
the <code>Visit_occurrence</code> table, and it will perform the
reshaping operation to make this merge possible.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span>table <span class="op">=</span> <span class="st">"visit_detail"</span>,</span>
<span>      conceptFilter <span class="op">=</span> <span class="fl">581383</span>,</span>
<span>      columnFilter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"visit_detail_start_date"</span>, <span class="st">"visit_detail_end_date"</span><span class="op">)</span>,</span>
<span>      mergeColumn <span class="op">=</span> <span class="st">"visit_occurrence_id"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.summary.html" class="external-link">ds.summary</a></span><span class="op">(</span><span class="st">"visit_detail"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $brge</span></span>
<span><span class="co">## $brge$class</span></span>
<span><span class="co">## [1] "omop.cdm.table" "data.frame"    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`number of rows`</span></span>
<span><span class="co">## [1] 31</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`number of columns`</span></span>
<span><span class="co">## [1] 10</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`variables held`</span></span>
<span><span class="co">##  [1] "visit_occurrence_id"                                      </span></span>
<span><span class="co">##  [2] "inpatient_cardiac_care_facility.person_id"                </span></span>
<span><span class="co">##  [3] "inpatient_cardiac_care_facility.visit_detail_start_date"  </span></span>
<span><span class="co">##  [4] "inpatient_cardiac_care_facility.visit_detail_end_date"    </span></span>
<span><span class="co">##  [5] "inpatient_cardiac_care_facility.2.person_id"              </span></span>
<span><span class="co">##  [6] "inpatient_cardiac_care_facility.2.visit_detail_start_date"</span></span>
<span><span class="co">##  [7] "inpatient_cardiac_care_facility.2.visit_detail_end_date"  </span></span>
<span><span class="co">##  [8] "inpatient_cardiac_care_facility.3.person_id"              </span></span>
<span><span class="co">##  [9] "inpatient_cardiac_care_facility.3.visit_detail_start_date"</span></span>
<span><span class="co">## [10] "inpatient_cardiac_care_facility.3.visit_detail_end_date"</span></span></code></pre>
<p>If no <code>mergeColumn</code> is specified, the <code>get</code>
method will assume <code>person_id</code> as the default merge column,
as this is the most common column that is used to merge tables in an
OMOP CDM database.</p>
</div>
<div class="section level3">
<h3 id="filtering-by-person-ids">2.2.3 Filtering by person IDs<a class="anchor" aria-label="anchor" href="#filtering-by-person-ids"></a>
</h3>
<p>The <code>personFilter</code> argument allows for the retrieval of
data for a specific subset of person IDs. This can be useful when
working with a large dataset and only needing to retrieve data for a
specific group of individuals.</p>
<p>To use the <code>personFilter</code> parameter, we have to specify
the symbol of another table that already exists in the R environment.
This referenced table has to contain <code>person_id</code> values that
may represent a subset of the <code>person_id</code> values in the table
that we aim to retrieve. By applying this parameter, the retrieval
process filters the target table to include only records corresponding
to the <code>person_id</code> values present in the referenced table,
thereby excluding any records associated with <code>person_id</code>
values not contained in the referenced table.</p>
<p>Utilizing the subsetting functions provided by the
<code>dsBaseClient</code> package can significantly enhance the
versatility of filtering database records based on cohorts, conditions,
or any other characteristics defining a subset of individuals.
Furthermore, the <code>dsOMOP</code> package implements a disclosure
control process that prevents the retrieval of tables containing
information on a number of patients below a predefined threshold set in
the server’s configuration. This ensures the security and
confidentiality of the data at all times.</p>
<p>Let’s perform a simple example to illustrate the potential of this
feature.</p>
<p>Suppose we are interested in analyzing data from patients who have
records of the condition <code>Chest pain</code> (Concept ID
<code>77670</code> in <code>Condition_occurrence</code>). We can save
this information to a specific <code>symbol</code> and then pass it as
the <code>personFilter</code> argument to the <code>get</code> method
for the <code>Person</code> table.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span>table <span class="op">=</span> <span class="st">"condition_occurrence"</span>,</span>
<span>      conceptFilter <span class="op">=</span> <span class="fl">77670</span>, <span class="co"># `Chest pain`</span></span>
<span>      columnFilter <span class="op">=</span> <span class="st">"condition_start_date"</span>,</span>
<span>      symbol <span class="op">=</span> <span class="st">"chest_pain_condition"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.summary.html" class="external-link">ds.summary</a></span><span class="op">(</span><span class="st">"chest_pain_condition"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $brge</span></span>
<span><span class="co">## $brge$class</span></span>
<span><span class="co">## [1] "omop.cdm.table" "data.frame"    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`number of rows`</span></span>
<span><span class="co">## [1] 4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`number of columns`</span></span>
<span><span class="co">## [1] 4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`variables held`</span></span>
<span><span class="co">## [1] "person_id"                        </span></span>
<span><span class="co">## [2] "chest_pain.condition_start_date"  </span></span>
<span><span class="co">## [3] "chest_pain.2.condition_start_date"</span></span>
<span><span class="co">## [4] "chest_pain.3.condition_start_date"</span></span></code></pre>
<p>We stored the measurements in the <code>chest_pain_condition</code>
symbol. Now we can use this <code>symbol</code> to filter the
<code>Person</code> table and retrieve only the data related to these
patients:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span>table <span class="op">=</span> <span class="st">"person"</span>,</span>
<span>      symbol <span class="op">=</span> <span class="st">"person_with_chest_pain"</span>,</span>
<span>      personFilter <span class="op">=</span> <span class="st">"chest_pain_condition"</span><span class="op">)</span></span></code></pre></div>
<p>Now we have a subset of the <code>Person</code> table that only
contains the data related to the patients who have records of the
condition <code>Chest pain</code>, stored in the
<code>person_with_chest_pain</code> symbol. We can pass it to the
<code>personFilter</code> argument of the <code>get</code> method for a
third table to retrieve only the data related to these patients. For
example, we can retrieve the <code>Observation</code> table using the
<code>person_with_chest_pain</code> symbol as the
<code>personFilter</code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span>table <span class="op">=</span> <span class="st">"observation"</span>,</span>
<span>      symbol <span class="op">=</span> <span class="st">"observation_from_person_with_chest_pain"</span>,</span>
<span>      columnFilter <span class="op">=</span> <span class="st">"observation_date"</span>,</span>
<span>      personFilter <span class="op">=</span> <span class="st">"person_with_chest_pain"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.summary.html" class="external-link">ds.summary</a></span><span class="op">(</span><span class="st">"observation_from_person_with_chest_pain"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $brge</span></span>
<span><span class="co">## $brge$class</span></span>
<span><span class="co">## [1] "omop.cdm.table" "data.frame"    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`number of rows`</span></span>
<span><span class="co">## [1] 4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`number of columns`</span></span>
<span><span class="co">## [1] 887</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`variables held`</span></span>
<span><span class="co">##  [1] "person_id"                                              </span></span>
<span><span class="co">##  [2] "history_of_clinical_finding_in_subject.observation_date"</span></span>
<span><span class="co">##  [3] "primary_insurance.observation_date"                     </span></span>
<span><span class="co">##  [4] "preferred_language.observation_date"                    </span></span>
<span><span class="co">##  [5] "cost_containment.observation_date"                      </span></span>
<span><span class="co">##  [6] "cost_containment.2.observation_date"                    </span></span>
<span><span class="co">##  [7] "cost_containment.3.observation_date"                    </span></span>
<span><span class="co">##  [8] "pain_severity_reported.observation_date"                </span></span>
<span><span class="co">##  [9] "pain_severity_reported.2.observation_date"              </span></span>
<span><span class="co">## [10] "acceptable_pain_level_status.observation_date"          </span></span>
<span><span class="co">##  [ reached getOption("max.print") -- omitted 877 entries ]</span></span></code></pre>
<p>The <code>Observation</code> table we retrieved only contains data
related to the patients who have records of the condition
<code>Chest pain</code>.</p>
<p>This way, we can easily filter the data we are interested in and work
with a subset of the data that is relevant to our study. This can also
be done with cohorts, conditions, and any other characteristics that
define a subset of individuals. It is done at query time, which makes
data retrieval very fast and efficient.</p>
<p>In the next article, we will see how to use the
<code>dsBaseClient</code> package to combine the data we have retrieved
to create a combined dataset that can be used for analysis.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://github.com/davidsarratgonzalez" class="external-link">David Sarrat González</a>, <a href="https://github.com/ESCRI11" class="external-link">Xavier Escribà-Montagut</a>, <a href="https://github.com/isglobal-brge" class="external-link">Juan R González</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer>
</body>
</html>
